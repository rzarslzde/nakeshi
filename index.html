<!doctype html>
<html lang="en" class="h-full">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Service Countdown</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Black+Ops+One&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/luxon@3/build/global/luxon.min.js"></script>

  <style>
    :root {
      --camo-1:#0f1b12; --camo-2:#1b2a1b; --camo-3:#2b3e2b; --camo-4:#3f5a3a;
      --accent:#9AE6B4;
    }
    body { background: radial-gradient(circle at 20% 10%, var(--camo-3), var(--camo-1) 60%) fixed; }
    .panel {
      background:
        radial-gradient(120px 80px at 20% 30%, rgba(255,255,255,.03), transparent 70%),
        radial-gradient(100px 60px at 80% 70%, rgba(255,255,255,.02), transparent 70%),
        linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      backdrop-filter: blur(6px);
      border: 1px solid rgba(255,255,255,.08);
    }
    .title { font-family: "Black Ops One", system-ui, sans-serif; letter-spacing: .02em; }
    .tick { transition: transform .2s ease, opacity .2s ease; will-change: transform, opacity; }
    .tick-enter { transform: translateY(8px); opacity: 0; }
    .tick-show  { transform: translateY(0);   opacity: 1; }
    .mono { font-variant-numeric: tabular-nums; }
    .badge { background: rgba(154,230,180,.12); border: 1px solid rgba(154,230,180,.25); }
    .bar { height: 10px; border-radius: 999px; background: rgba(255,255,255,.08); overflow: hidden; }
    .bar>span { display:block; height:100%; background: linear-gradient(90deg,#86efac,#4ade80); }
  </style>
</head>
<body class="h-full text-white">
  <main class="min-h-screen flex items-center justify-center p-6">
    <div class="w-full max-w-3xl">
      <!-- Header -->
      <header class="mb-8 text-center">
        <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full badge">
          <span class="text-sm text-emerald-200">ü™ñ Soldier‚Äôs Countdown</span>
        </div>
        <h1 id="title" class="title mt-4 text-3xl sm:text-4xl">
          D-Day: End of Service
        </h1>
        <p class="mt-2 text-sm text-emerald-200/70">Reading <code class="text-emerald-200">end-date.json</code> from this repository</p>
      </header>

      <!-- Card -->
      <section class="panel rounded-2xl p-6 sm:p-10 shadow-2xl">
        <p id="countdown"
           class="mono text-xl sm:text-2xl leading-relaxed font-semibold text-center text-emerald-100">
           Loading‚Ä¶
        </p>

        <!-- Milestones -->
        <div class="mt-8 grid grid-cols-2 gap-4">
          <div class="rounded-xl p-4 bg-white/5 ring-1 ring-white/10 text-center">
            <div class="text-xs text-emerald-200/80 tracking-wider">TOTAL DAYS</div>
            <div id="daysTotal" class="mt-1 text-2xl font-bold mono">‚Äî</div>
            <div class="text-[11px] text-emerald-200/60">remaining</div>
          </div>
          <div class="rounded-xl p-4 bg-white/5 ring-1 ring-white/10 text-center">
            <div class="text-xs text-emerald-200/80 tracking-wider">TOTAL HOURS</div>
            <div id="hoursTotal" class="mt-1 text-2xl font-bold mono">‚Äî</div>
            <div class="text-[11px] text-emerald-200/60">to go</div>
          </div>
        </div>

        <!-- Progress -->
        <div id="progressWrap" class="mt-8 hidden">
          <div class="flex items-center justify-between text-sm text-emerald-200/80 mb-2">
            <span>Service Progress</span>
            <span id="progressPct" class="mono">0%</span>
          </div>
          <div class="bar"><span id="progressBar" style="width:0%"></span></div>
          <p id="startEndInfo" class="mt-2 text-xs text-emerald-200/60 mono"></p>
        </div>

        <!-- Footer -->
        <div class="mt-8 text-center text-emerald-200/70 text-sm">
          <span>‚è±Ô∏è Updates every second ‚Äî </span>
          <span id="endInfo" class="mono"></span>
        </div>
      </section>
    </div>
  </main>

  <script>
    (function () {
      const { DateTime } = luxon;

      const elTitle   = document.getElementById('title');
      const elCd      = document.getElementById('countdown');
      const elDays    = document.getElementById('daysTotal');
      const elHours   = document.getElementById('hoursTotal');
      const elEndInfo = document.getElementById('endInfo');
      const wrapProg  = document.getElementById('progressWrap');
      const bar       = document.getElementById('progressBar');
      const pct       = document.getElementById('progressPct');
      const startEnd  = document.getElementById('startEndInfo');

      let endAt = null, startAt = null;

      function fmt(parts) {
        return `${parts.years} years, ${parts.months} months, ${parts.days} days, ` +
               `${parts.hours} hours, ${parts.minutes} minutes and ${parts.seconds} seconds`;
      }

      function calcFutureDiff(now, end) {
        const dur = now.until(end)
          .toDuration(['years','months','days','hours','minutes','seconds'])
          .shiftTo('years','months','days','hours','minutes','seconds');
        return {
          years: Math.max(0, Math.floor(dur.years ?? 0)),
          months: Math.max(0, Math.floor(dur.months ?? 0)),
          days: Math.max(0, Math.floor(dur.days ?? 0)),
          hours: Math.max(0, Math.floor(dur.hours ?? 0)),
          minutes: Math.max(0, Math.floor(dur.minutes ?? 0)),
          seconds: Math.max(0, Math.floor(dur.seconds ?? 0))
        };
      }

      function updateProgress(now){
        if (!startAt || !endAt) return;
        const total = endAt.diff(startAt).as('seconds');
        const passed = now.diff(startAt).as('seconds');
        const ratio = Math.min(1, Math.max(0, passed / total));
        const percent = Math.round(ratio * 100);
        bar.style.width = percent + '%';
        pct.textContent = percent + '%';
        startEnd.textContent = `Start: ${startAt.toISO({ suppressMilliseconds:true })}  |  End: ${endAt.toISO({ suppressMilliseconds:true })}`;
      }

      function tick() {
        if (!endAt) return;
        const now = DateTime.now();

        if (now >= endAt) {
          elCd.textContent = 'üéñÔ∏è Mission complete. Discharge achieved.';
          elDays.textContent  = '0';
          elHours.textContent = '0';
          updateProgress(now);
          return;
        }

        const parts = calcFutureDiff(now, endAt);
        elCd.classList.add('tick','tick-enter');
        requestAnimationFrame(() => {
          elCd.textContent = `Remaining: ${fmt(parts)}`;
          elCd.classList.remove('tick-enter');
          elCd.classList.add('tick-show');
          setTimeout(() => elCd.classList.remove('tick','tick-show'), 150);
        });

        elDays.textContent  = Math.max(0, Math.floor(endAt.diff(now, 'days').days)).toLocaleString();
        elHours.textContent = Math.max(0, Math.floor(endAt.diff(now, 'hours').hours)).toLocaleString();
        updateProgress(now);
      }

      async function loadConfig() {
        try {
          const res = await fetch('./end-date.json', { cache: 'no-store' });
          if (!res.ok) throw new Error('Cannot read end-date.json');
          const json = await res.json();
          if (!json.end) throw new Error('Missing "end" field in end-date.json');

          endAt = DateTime.fromISO(json.end, { setZone: true });
          if (!endAt.isValid) throw new Error('Invalid ISO date in "end"');

          if (json.start) {
            startAt = DateTime.fromISO(json.start, { setZone: true });
            if (startAt.isValid) wrapProg.classList.remove('hidden');
          }

          if (json.title) elTitle.textContent = json.title;
          elEndInfo.textContent = `Target: ${endAt.toISO({ suppressMilliseconds:true })}`;

          tick();
          setInterval(tick, 1000);
        } catch (err) {
          console.error(err);
          elCd.textContent = 'Error: could not load end-date.json. Make sure the file exists.';
        }
      }

      loadConfig();
    })();
  </script>
</body>
</html>
